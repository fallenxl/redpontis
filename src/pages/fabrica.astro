---
import Layout from "../layouts/Layout.astro";

/* Fabrica.astro — Página completa (refactor) */
type Card = { title: string; desc: string };

const cardPresente: Card[] = [
  { title: "POS / mPOS", desc: "Terminales físicas y móviles con chip, banda y contactless. Integración a backoffice y reportería." },
  { title: "Tap to Phone (marca blanca)", desc: "Aceptación contactless en smartphones. Onboarding ágil, KYC y administración centralizada." },
  { title: "Eloop en tienda", desc: "Digitalización de depósitos, retiros, conciliaciones y auditoría con trazabilidad." },
  { title: "Tokenización presencial", desc: "Vault seguro para reutilización de tarjetas y experiencias omnicanal." }
];

const cardNoPresente: Card[] = [
  { title: "Payment Gateway", desc: "Pasarela para ecommerce con antifraude, 3DS, split, multi-adquirente y fallback." },
  { title: "Cobros recurrentes", desc: "Motor de suscripciones con prorrateo, retiros programados y alertas de falla." },
  { title: "RT-Payments (Visa Direct / MC Send)", desc: "Envío y recepción de fondos 24/7 para devoluciones, dispersión y remesas." },
  { title: "Billetera móvil + QR", desc: "QR estático/dinámico, NFC, loyalty y pagos de servicios con UX ágil." }
];

const cardValorAgregado: Card[] = [
  { title: "Analytics", desc: "Paneles de conversión, rutas de fallo y cohortes por canal, producto y comercio." },
  { title: "Fraude & Riesgo", desc: "Reglas dinámicas, listas y conexión con proveedores externos." },
  { title: "Backoffice", desc: "Gestión de comercios, liquidaciones, ajustes y reclamos." },
  { title: "Compliance", desc: "PCI DSS / PCI PIN, ISO 9001 / 37001 y mejores prácticas de seguridad." }
];
---

<Layout>
  <!-- Hero -->
  <section id="fab-hero" class="relative overflow-hidden flex items-center">
    <!-- Glows -->
    <div aria-hidden="true" class="pointer-events-none absolute inset-0">
      <div class="absolute -top-24 left-1/2 h-[42rem] w-[42rem] -translate-x-1/2 rounded-full bg-[#B41A1D]/10 blur-3xl"></div>
      <div class="absolute -bottom-24 -right-24 h-[32rem] w-[32rem] rounded-full bg-[#575756]/10 blur-3xl"></div>
    </div>

    <div class="relative mx-auto max-w-7xl px-4 md:px-6 pt-28 md:pt-36 pb-20">
      <header class="text-center mx-auto max-w-3xl">
        <h1 class="heavitas text-4xl md:text-5xl leading-tight text-[#121212]" data-i18n="factoryPage.hero.title">
          Desde el diseño hasta la implementación,
        </h1>
        <p class="mt-2 heavitas text-2xl md:text-3xl text-[#B41A1D]" data-i18n="factoryPage.hero.subtitle">
          desarrollamos software flexible y seguro
        </p>
        <p class="mt-4 text-[#575756] md:text-lg" data-i18n="factoryPage.hero.desc">
          Orquestamos canales y proveedores para acelerar el time-to-market con seguridad y escalabilidad.
        </p>
      </header>
    </div>
  </section>

  <!-- Tarjeta Presente -->
  <section id="tarjeta-presente" class="relative bg-white">
    <div class="mx-auto max-w-7xl px-4 md:px-6 py-12 md:py-16">
      <h3 class="heavitas text-xl md:text-2xl text-[#121212]" data-i18n="factoryPage.sections.present">Tarjeta presente</h3>

      <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
        {cardPresente.map((c, i) => (
          <article class="fab-card group rounded-2xl bg-white p-5 shadow-sm ring-1 ring-black/5 transition will-change-transform focus-within:ring-[#B41A1D]/40 hover:-translate-y-1 hover:shadow-md">
            <div class="flex items-start gap-3">
              <div class="grid size-10 place-items-center rounded-xl bg-[#B41A1D]/10 ring-1 p-2 ring-[#B41A1D]/20" aria-hidden="true">
                <i class="fas fa-credit-card text-[#B41A1D] size-5"></i>
              </div>
              <div>
                <h4 class="font-bold text-[#B41A1D] text-lg" data-i18n={`factoryPage.cards.present.${i}.title`}>{c.title}</h4>
                <p class="mt-1 text-[#575756] text-sm leading-relaxed" data-i18n={`factoryPage.cards.present.${i}.desc`}>{c.desc}</p>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- Tarjeta No Presente -->
  <section id="tarjeta-no-presente" class="relative bg-white">
    <div class="mx-auto max-w-7xl px-4 md:px-6 py-12 md:py-16">
      <h3 class="heavitas text-xl md:text-2xl text-[#121212]" data-i18n="factoryPage.sections.notPresent">Tarjeta no presente</h3>

      <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
        {cardNoPresente.map((c, i) => (
          <article class="fab-card group rounded-2xl bg-white p-5 shadow-sm ring-1 ring-black/5 transition will-change-transform focus-within:ring-[#B41A1D]/40 hover:-translate-y-1 hover:shadow-md">
            <div class="flex items-start gap-3">
              <div class="grid size-10 place-items-center rounded-xl bg-[#575756]/10 ring-1 p-2 ring-[#575756]/20" aria-hidden="true">
                <i class="fas fa-laptop size-5 text-[#575756]"></i>
              </div>
              <div>
                <h4 class="font-bold text-[#B41A1D] text-lg" data-i18n={`factoryPage.cards.notPresent.${i}.title`}>{c.title}</h4>
                <p class="mt-1 text-[#575756] text-sm leading-relaxed" data-i18n={`factoryPage.cards.notPresent.${i}.desc`}>{c.desc}</p>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>

  <!-- Valor agregado -->
  <section id="valor-agregado" class="relative overflow-hidden bg-white">
    <div aria-hidden="true" class="pointer-events-none absolute inset-0">
      <div class="absolute -top-24 left-1/2 h-[36rem] w-[36rem] -translate-x-1/2 rounded-full bg-[#B41A1D]/10 blur-3xl"></div>
    </div>

    <div class="relative mx-auto max-w-7xl px-4 md:px-6 py-12 md:py-16">
      <h3 class="heavitas text-xl md:text-2xl text-[#121212]" data-i18n="factoryPage.sections.valueAdded">Valor agregado</h3>

      <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
        {cardValorAgregado.map((c, i) => (
          <article class="va-card group relative rounded-2xl bg-white p-5 shadow-sm ring-1 ring-black/5 transition will-change-transform hover:-translate-y-1 hover:shadow-md">
            <div class="absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-[#B41A1D] to-[#575756] opacity-0 transition-opacity duration-200 group-hover:opacity-100"></div>
            <div class="flex items-start gap-3">
              <div class="grid size-10 place-items-center rounded-xl bg-white ring-1 p-2 ring-[#575756]/15" aria-hidden="true">
                <svg viewBox="0 0 24 24" class="size-5"><path d="M4 12h16M12 4v16" stroke="#575756" stroke-width="2"/></svg>
              </div>
              <div>
                <h4 class="font-bold text-[#B41A1D] text-lg" data-i18n={`factoryPage.cards.valueAdded.${i}.title`}>{c.title}</h4>
                <p class="mt-1 text-[#575756] text-sm leading-relaxed" data-i18n={`factoryPage.cards.valueAdded.${i}.desc`}>{c.desc}</p>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>
</Layout>

<script lang="ts">
  import gsap from "gsap";
  import ScrollTrigger from "gsap/ScrollTrigger";
  gsap.registerPlugin(ScrollTrigger);

  const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches 

  function revealOnScroll(selector, options = {}) {
    const els = document.querySelectorAll(selector);
    els.forEach((el, i) => {
      gsap.from(el, {
        opacity: 0,
        y: prefersReducedMotion ? 0 : 18,
        duration: 0.6,
        delay: i * 0.06,
        ease: "power3.out",
        scrollTrigger: { trigger: el, start: "top 85%", once: true },
        ...options
      });
    });
  }

  revealOnScroll("#tarjeta-presente .fab-card");
  revealOnScroll("#tarjeta-no-presente .fab-card");
  revealOnScroll("#valor-agregado .va-card");

  if (!prefersReducedMotion) {
    const glow = document.querySelector("#fab-hero .absolute.-top-24");
    if (glow) {
      gsap.to(glow, {
        yPercent: 8,
        ease: "none",
        scrollTrigger: {
          trigger: "#fab-hero",
          start: "top top",
          end: "bottom top",
          scrub: 0.4
        }
      });
    }
  }

  // Re-aplicar traducciones de esta página al cambiar idioma
  window.addEventListener("rp:langchange", () => {
    (window).rpI18n?.apply?.(document.body);
  });
</script>
